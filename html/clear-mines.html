<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Clear Mines</title>
<style>
body{
    margin: 0px;
    padding:0px;
    background-color: black;
}
#main{
    margin: 10px;
    padding: 5px;
    width: 540px;
    height: 540px;
    border: 1px solid #063540;
}
.common_card{
    width: 50px;
    height: 50px;
    margin: 2px;
    background-color: #2A7A8C;
    float: left;
    font-size: 25px;
    text-align: center;
    line-height: 50px;
}
.turn_card{
    background-color: #E5D9CF;
}
.hand{
    cursor: pointer;
}
.mark{
    background-color: #403D3A;
}
.red_word{
    color: red;
    font-weight: bold;
}

.clean{
    clear: both;
}

#debug{
    display: none;
    position: absolute;
    border: 1px dashed red;
    margin: 5px;
    padding: 5px;
    color: #E5D9CF;
}
.sub-obj{
    padding: 5px;
    margin: 5px;
    border: 1px dashed blue;
    position: relative;
    top: 5px;
    left: 5px;
}
.title{
    font-weight: bold;
    font-size: 1em;
}
<!--  2A7A8C 176273 063540 E5D9CF 403D3A -->
</style>
</head>
<body>
<div id="main"></div>
<div id="debug"></div>
</body>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript">
var clear_mines = {
    /** 定义全局变量 */
    rows: 10,
    column: 10,
    mines_count: 11,
    map: [],        // 雷分布
    pre_map: [],    // 预处理
    pick_up: [],    // 翻开的
    mark: [],       // 标记的
    operate_container: {},  // 用户操作
    win: 'WIN!',
    over: 'Game Over!',
    main: {},

    init: function(arg_rows, arg_column, arg_count){
        /** 处理参数 */
        if ('undefined' !== typeof(arg_rows) && arg_rows - 0 > clear_mines.rows)
        {
            clear_mines.rows = arg_rows;
        }
        if ('undefined' !== typeof(arg_column) && arg_column - 0 > clear_mines.column)
        {
            clear_mines.column = arg_column;
        }
        if ('undefined' !== typeof(arg_count) && arg_count - 0 > clear_mines.mines_count)
        {
            clear_mines.mines_count = arg_count;
        }

        var rows   = clear_mines.rows;
        var column = clear_mines.column;
        var count  = clear_mines.mines_count;
        clear_mines.main = $('#main');

        /** 初始化数据结构 */
        if (-1 == clear_mines.init_game(rows, column, count))
        {
            alert('Init game fail, please check it out.');
            return false;
        }

        /** 初始化UI 界面 */
        clear_mines.init_ui(rows, column, count);

        /** 启动游戏 */
        setTimeout(function(){
            clear_mines.bind_event();
            //clear_mines.game_over();
            //clear_mines.game_win();
        }, 100);
    },

    init_game: function(rows, column, count){
        for (var i = 0; i < rows; i++)
        {
            clear_mines.map[i]     = [];
            clear_mines.mark[i]    = [];
            clear_mines.pick_up[i] = [];

            for (var k = 0; k < column; k++)
            {
                clear_mines.map[i][k]     = 0;
                clear_mines.mark[i][k]    = 0;
                clear_mines.pick_up[i][k] = 0;
            }
        }

        /** 创建雷*/
        var rand_obj = {};
        while (util.get_obj_count(rand_obj) < count)
        {
            var rand = Math.floor(Math.random() * (rows * column));
            rand_obj[rand] = rand;
        }
        //var html = '';
        for (var key in rand_obj)
        {
            var _rows  = Math.floor(key / rows);
            var _colum = key % column;
            clear_mines.map[_rows][_colum] = 1;
            //html += _rows + ', ' + _colum + '\n';
        }
        //alert(html);

        /** 预处理 */
        //var html = '';
        for (var i = 0; i < rows; i++)
        {
            clear_mines.pre_map[i] = [];
            for (var k = 0; k < column; k++)
            {
                //html += '{'
                clear_mines.pre_map[i][k] = [];
                /** i -> rows, k -> column */
                var op_map = [
                    [-1, 0],    // up
                    [-1, 1],    // right up
                    [0, 1],     // right
                    [1, 1],     // right down
                    [1, 0],     // down
                    [1, -1],    // left down
                    [0, -1],    // left
                    [-1, -1]    // left up
                ];
                var len = op_map.length;
                var count = 0;
                var m = 0;
                for (; m < len; m++)
                {
                    var find_row   = i - 0 + (op_map[m][0] - 0);
                    var find_colum = k - 0 + (op_map[m][1] - 0);
                    var find_pos   = 0;
                    if (find_row < 0 || find_colum < 0 || find_row >= rows || find_colum >= column)
                    {
                        find_pos = -1;
                    }
                    else if (clear_mines.map[find_row]
                            && clear_mines.map[find_row][find_colum]
                            && 1 === clear_mines.map[find_row][find_colum])
                    {
                        find_pos = 1;
                        count++;
                    }

                    clear_mines.pre_map[i][k][m] = find_pos;
                    //html += '(' + find_row + ', ' + find_colum + '),';
                }
                clear_mines.pre_map[i][k][m] = count;   // 当前块周围雷的数目.
                //html += '}';
            }
            //html += '\n';
        }
        //alert(html);

        return 0;
    },

    init_ui: function(rows, column, count){
        var html = '';
        for (var i = 0; i < rows; i++)
        {
            for (var k = 0; k < column; k++)
            {
                var id = i + '-' + k;
                html += '<div class="common_card hand';
                html += 1 === clear_mines.map[i][k] ? ' turn_card' : '';
                html += '" id="' + id + '">';
                //html += '&nbsp;';
                html += clear_mines.map[i][k];
                html += '</div>';
            }
        }

        clear_mines.main.html(html);
    },

    bind_event: function(){
        $('.common_card').mousedown(function(ev){
            switch (ev.which - 0)
            {
                case 1: // left
                    clear_mines.turn_card_event();
                    break;

                case 3: // right
                    clear_mines.mark_card_event();
                    break;
            }

            clear_mines.check_win();
            return false;
        });
    },

    turn_card_event: function(){
        debuger.pr('turn_card_event');
    },

    mark_card_event: function(){
        debuger.pr('mark_card_event');
    },

    clean_event: function(){
        $('.common_card').unbind('click');
    },

    check_win: function(){
        debuger.pr('check_win');
    },

    game_win: function(){
        clear_mines._print_msg(clear_mines.win);
    },

    game_over: function(){
        clear_mines._print_msg(clear_mines.over);
    },

    _print_msg: function(msg){
        clear_mines.clean_event();
        var msg_len = msg.length;
        var rows    = Math.floor(clear_mines.rows / 2);
        var column  = Math.floor(clear_mines.column / 2) - Math.floor(msg_len / 2);
        column = column >=0 ? column : 0;

        for (var i = 0; i < msg_len && column < clear_mines.column; i++)
        {
            var id = '#' + rows + '-' + column;
            $(id).html(msg[i]).addClass('red_word');
            column++;
        }
    }
};

var util = {
    get_obj_count: function(obj){
        var obj = obj || {};
        var count = 0;
        if ('object' !== typeof(obj))
        {
            return count;
        }

        for (var key in obj)
        {
            count++;
        }

        return count;
    }
};

var debuger = {
    _debug: function(data)
    {
        var html = '';
        var title_tag = '<span class="title">';
        var title_span= '</span>';

        if ('string' == typeof(data) || 'number' == typeof(data))
        {
            return title_tag + 'String OR Number: ' + title_span + data + '<br />';
        }
        else if ('boolean' == typeof(data))
        {
            return title_tag + 'Boolean: ' + title_span + (data ? 'true' : 'false') + '<br />';
        }
        else if ('function' == typeof(data))
        {
            return title_tag + 'It is a function.' + title_span + '<br />';
        }
        else if ('object' == typeof(data))
        {
            if ('undefined' == typeof(data.length))
            {
                var key;
                html += title_tag + 'It is a object.' + title_span + "<br />";
                for (key in data)
                {
                    if ('object' == typeof(data[key]))
                    {
                        html += '<div class="sub-obj">' + debuger._debug(data[key]) + '</div>';
                    }
                    else
                    {
                        html += key + ': ' + data[key] + "<br />";
                    }
                }

                return html;
            }
            else
            {
                var len = data.length;
                var tip = title_tag + 'It is array.' + title_span + "<br />";
                for (var i = 0; i < len; i++)
                {
                    if ('object' == typeof(data[i]))
                    {
                        html += i + ': <div class="sub-obj">' + debuger._debug(data[i]) + '</div>';
                    }
                    else
                    {
                        html += i + ': ' + data[i] + '<br />';
                    }
                }

                return tip + html;
            }
        }
        else
        {
            return title_tag + 'It is undefined...' + title_span;
        }
    },

    pr: function(data)
    {
        var html = this._debug(data);
        $('#debug').append(html).show();
    }
};

$(document).bind("contextmenu",function(e){
    return false;
});

$(document).ready(function(){
    clear_mines.init();
});
</script>
</html>
